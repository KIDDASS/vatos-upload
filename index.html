<!doctype html>
<input type="password" name="password" placeholder="upload password" required />
</label>


<label>
Commit message (optional)
<input type="text" name="message" placeholder="Add a commit message" />
</label>


<button type="submit">Upload to GitHub</button>
</form>


<div id="result" style="margin-top:16px"></div>


<script>
const form = document.getElementById('uploadForm');
const result = document.getElementById('result');


form.addEventListener('submit', async (e) => {
e.preventDefault();
result.textContent = 'Uploading...';


const fd = new FormData(form);
const file = fd.get('image');
const password = fd.get('password');
const message = fd.get('message') || `Upload ${file.name}`;


if (!file) return result.textContent = 'No file chosen.';


try {
// Read file as ArrayBuffer and convert to base64
const ab = await file.arrayBuffer();
const bytes = new Uint8Array(ab);
let binary = '';
for (let i = 0; i < bytes.byteLength; i++) binary += String.fromCharCode(bytes[i]);
const b64 = btoa(binary);


const payload = {
filename: file.name,
content: b64,
message,
password
};


const res = await fetch('/api/upload', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(payload)
});


const json = await res.json();
if (!res.ok) throw new Error(json.error || JSON.stringify(json));


result.innerHTML = `âœ… Uploaded! File: <a href="${json.html_url}" target="_blank">${json.path}</a>`;
} catch (err) {
console.error(err);
result.textContent = 'Error: ' + (err.message || err);
}
});
</script>
</body>
</html>
